<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Player Search</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script> 
	<link rel="icon" href="https://icons.iconarchive.com/icons/martz90/circle/512/nhl-icon.png">
	<script src="static\scripts.js"></script>
  </head>
  <body>
    {% extends "template.html" %}
    {% block content %}
	<br>
    <form>
        <input type="text" id="player" name="search" placeholder="Enter player name...">
    </form>
    
    <input type="button" value="Search" id="submit" onclick="sendData()"></button>
    <img id="hero">

	<p id="season"></p>
    <div id="output"></div>
	<p id="career"></p>
	<div id="career_output"></div>
	<p id="awards"></p>
	<div id="awards_output"></div>

    <script>

        function sendData () {

            var data = JSON.parse(' {{ value | tojson | safe}}');

            const player_name = document.getElementById("player").value;

            $.ajax({
                url: '/process',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ 'value': player_name }),
                success: function(response) {

                    document.getElementById('season').innerHTML = "<br><b>2023 - 2024 Season Stats</b> <br><br>";
                    document.getElementById('output').innerHTML = response.result.firstName['default'] + " ";
                    document.getElementById('output').innerHTML += response.result.lastName['default'] + "<br>";
                    document.getElementById('output').innerHTML += "<img src='" + response.result.heroImage + "'width=70 height=70><br>";
                	document.getElementById('output').innerHTML += "<img src='" + response.result.teamLogo + "'width=30 height=30>";
                    document.getElementById('output').innerHTML += response.result.fullTeamName['default'] + "<br>";
                    document.getElementById('output').innerHTML += "Position: " + response.result.position + "<br>";

                    // check if player is a goalie or skater 
                    if (response.result.position != 'G') {
                        document.getElementById('output').innerHTML += "Games Played: " + response.result.featuredStats['regularSeason']['subSeason']['gamesPlayed'] + "<br>";
                        document.getElementById('output').innerHTML += "Goals: " + response.result.featuredStats['regularSeason']['subSeason']['goals'] + "<br>";
                        document.getElementById('output').innerHTML += "Assists: " + response.result.featuredStats['regularSeason']['subSeason']['assists'] + "<br>";
                        document.getElementById('output').innerHTML += "Points: " + response.result.featuredStats['regularSeason']['subSeason']['points'] + "<br><br>";
                        document.getElementById('career').innerHTML = "<b>Career Stats</b> <br><br>";
                        document.getElementById('career_output').innerHTML = "Games Played: " + response.result.featuredStats['regularSeason']['career']['gamesPlayed'] + "<br>";
                        document.getElementById('career_output').innerHTML += "Goals: " + response.result.featuredStats['regularSeason']['career']['goals'] + "<br>";
                        document.getElementById('career_output').innerHTML += "Assists: " + response.result.featuredStats['regularSeason']['career']['assists'] + "<br>";
                        document.getElementById('career_output').innerHTML += "Points: " + response.result.featuredStats['regularSeason']['career']['points'] + "<br>";
                    } else {
                        document.getElementById('career').innerHTML = "<br><b>Career Stats</b> <br><br>";
                        document.getElementById('career_output').innerHTML = "Games Played: " + response.result.featuredStats['regularSeason']['career']['gamesPlayed'] + "<br>";
                    }
					document.getElementById("awards").innerHTML = "<br><b>Awards</b> <br><br>";

                    var length = Object.keys(response.result.awards).length;
                    var year;

					document.getElementById('awards_output').innerHTML = "";
					
					for (var i = 0; i < length; i++) {

                        var number_of_years = Object.keys(response.result.awards[i].seasons).length;
                        var year;

                        if (number_of_years == 1) {
                            year = response.result.awards[i].seasons[0].seasonId;
							document.getElementById('awards_output').innerHTML += response.result.awards[i].trophy.default + " " + String(year).substr(0, 4) + " - " + String(year).substr(4, 8) + "<br>";
                        // check if the player has won the same award multiple times
                        } else {

                            for (var j = 0; j < number_of_years; j++) {
                                year = response.result.awards[i].seasons[j].seasonId;
                                document.getElementById('awards_output').innerHTML += response.result.awards[i].trophy.default + " " + String(year).substr(0, 4) + " - " + String(year).substr(4, 8) + "<br>";
                            }
                        }    
					}
				},
                error: function(error) {
                	document.getElementById('output').innerHTML = "Player not found";
                	console.log(error);
                }
            });
        }
       
    </script>
      
    {% endblock %}
  </body>
</html>